# Checking for necessary packages
library("dplyr")
library("corrplot")


#Pulling in data from downloaded csv's
#Data was obtained from Federal Reserve Economic Data as well as Census.gov data


VA_Emissions <- read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/VA_Emissions_A.csv")

VA_Discouraged <- read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/VA_Discouraged_A.csv")

VA_Spending <- read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/VA_Spending_A.csv")

VA_HH_Income <- read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/VA_HH_Income_A.csv")


#Merge the data into one table
Merge_Data <- VA_Emissions %>%
  inner_join(VA_Discouraged, by = "DATE") %>%
  inner_join(VA_Spending, by = "DATE") %>%
  inner_join(VA_HH_Income, by = "DATE")

#Change column names for better legibility
Raw_Variables <- Merge_Data %>% rename(VA_Emissions = EMISSCO2TOTVTTTOVAA, VA_Discouraged = DISCWORKVA, VA_Spending = VAPCE, VA_HH_Income = MEHOINUSVAA672N)

#Create table for variables without the DATE column and change to numeric 
Variables <- Raw_Variables %>%
  select(VA_Emissions, VA_Discouraged, VA_Spending, VA_HH_Income)

Variables <- Variables %>%
  mutate(
    VA_Emissions = as.numeric(VA_Emissions),
    VA_Discouraged = as.numeric(VA_Discouraged),
    VA_Spending = as.numeric(VA_Spending),
    VA_HH_Income = as.numeric(VA_HH_Income)
  )

#Create and print the correlation matrix
Correlation_Matrix <- cor(Variables)
print(Correlation_Matrix)

#Noticing the -0.76 Correlation Coefficient between Personal Spending and Emissions in Virginia, I wanted to dive deeper

#Check for Necessary package
library(ggplot2)

#Create data frame with the necessary variables
Data_for_graph <- data.frame(
  time = Raw_Variables$DATE,
  a = Raw_Variables$VA_Emissions,
  b = Raw_Variables$VA_Spending
)

#Use data frame to create the graph
ggplot(Data_for_graph) +
  geom_line(aes(x = time, y = a, color = "Emissions")) +
  geom_line(aes(x = time, y = (b - 150000) / 3500 + 50, color = "Spending")) +
  scale_y_continuous(
    name = "Emissions",
    limits = c(50, 120),
    sec.axis = sec_axis(~ (. - 50) * 3500 + 150000, 
    name = "Spending")
  ) +
  labs(title = "Emissions vs. Spending in Virginia",
       x = "Time",
       y = "Values") +
  scale_color_manual(name = "Variables", values = c("Emissions" = "red", "Spending" = "green"))





#Selecting only the interested variables in a separate table, while maintaining alignment on the date
t_variables <- Variables %>%
  select(VA_Emissions, VA_Spending)

#Running and printing results of an Independent T-Test
t_test_result <- t.test(t_variables$VA_Emissions, t_variables$VA_Spending)
print(t_test_result)

#Results of the T-Test reveal a p-value < 0.05. This means that the differences between the variables are significant.
#These results can be explained a few ways. First, recent technological advancements have made technology more energy efficient.
#As the tech evolves, more consumers are spending money on these products while we see emissions lower simultaneously.
#Second, there may have been a decline in jobs in the manufacturing field and other field related to emissions. At the same time,
#there has been a consistent increase in service-based jobs, leading to an increase in spending on services. Lastly, environmental friendly
#products have consistently been pushed over the past few years, possibly leading to a change in consumer preference, spending more money on
#products that are more environmentally friendly.

######################################################Import Manufacturing Jobs Data & Service Jobs Data as a line graph

#Limitations to this exploratory analysis would include the small sample size (df=17) as well as outside factors that could obviously be affecting either of these variables.

