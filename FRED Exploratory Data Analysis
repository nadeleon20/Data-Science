#Checking for necessary packages
library("dplyr")
library("corrplot")


# Loading all data into the script 
Unemployment = read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/Unemployment.csv")
CC_Delinq = read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/CC_Delinquency.csv")
Effective_Rate = read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/Effective_Rate.csv")

#Check column names within the data for the join to work
head(Unemployment)
head(CC_Delinq)
head(Effective_Rate)

#Kept seeing an error with the inner_join so renaming the columns to make sure they match
Unemployment <- Unemployment %>% rename(Date = DATE, Unemployment = UNRATE)
CC_Delinq <- CC_Delinq %>% rename (Date = DATE, CC_Rate = DRCCLACBS)
Effective_Rate <- Effective_Rate %>% rename (Date = DATE, Effect_Rate = DFF)

# Join the data together based on their dates
Merged_Data <- Unemployment %>%
  inner_join(CC_Delinq, by = "Date") %>%
  inner_join(Effective_Rate, by = "Date")

# Putting all the joined data into one table
Raw_Variables <- Merged_Data %>%
  select(Unemployment, CC_Rate, Effect_Rate)

# Mutating the data to be numeric for the sake of the correlation matrix
# All raw data is a percentage so mutating to numeric should maintain correlational relationships
Variables <- Raw_Variables %>%
  mutate(
    Unemployment = as.numeric(Unemployment),
    CC_Rate = as.numeric(CC_Rate),
    Effect_Rate = as.numeric(Effect_Rate)
  )

# Create and print correlation matrix
Correlation_Matrix <- cor(Variables)
print(Correlation_Matrix)

# Seeing that the correlation between Credit Card Delinquency and Effective Federal Fund Rate is 0.77,
# it is somewhat expected because of the relationship between the two factors. As the Federal Funds Rate
# increases, so does the Credit Card Interest Rate which makes it more difficult for low income families
# to make their minimum monthly payment, therefore increasing the Credit Card Delinquency Rate

# Next Correlation Matrix (Comparing Bond Market, S&P 500, Urban CPI, and Virginia House Price Index)
Bonds = read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/BofA_Bond_Total_Return.csv")
CPI = read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/Urban_CPI.csv")
SP500 = read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/SP500.csv")
VA_Index = read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/Virginia_House_Index.csv")

# Renaming columns for better legibility
Bonds <- Bonds %>% rename(Bonds_Index = BAMLHYH0A0HYM2TRIV)
CPI <- CPI %>% rename(CPI = CPIAUCSL)
VA_Index <- VA_Index %>% rename(VA_Index = VASTHPI)

# Inner Join the data together based on date
Merged_Data2 <- Bonds %>%
  inner_join(CPI, by = "DATE") %>%
  inner_join(SP500, by = "DATE") %>%
  inner_join(VA_Index, by = "DATE")

#
Raw_Variables2 <- Merged_Data2 %>%
  select(Bonds_Index, CPI, VA_Index, SP500)

# Declare variables as numeric for the sake of the correlation matrix
Variables2 <- Raw_Variables2 %>%
  mutate(
    Bonds_Index = as.numeric(Bonds_Index),
    CPI = as.numeric(CPI),
    VA_Index = as.numeric(VA_Index),
    SP500 = as.numeric(SP500)
  )

#Create and print second correlation matrix
Correlation_Matrix2 <- cor(Variables2)
print(Correlation_Matrix2)

#Based on the variables used for this correlation matrix, it is assumed that the variables are related.
#As the Bonds Market and SP500 increase in value, so does the Urban Consumer Price Index.
#Interestingly, these variables show a strong positive correlation (0.81 & 0.93) with Virginia Home Price as well.


# The next correlation I am looking for is between the education rate and homeownership rate in Virginia vs. DC
VA_Homes <- read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/VA_Home_Owner.csv")
VA_Education <- read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/VA_Education.csv")
DC_Homes <- read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/DC_Home_Owner.csv")
DC_Education <- read.csv("C:/Users/lilni/OneDrive - Mount St. Mary's University/Desktop/FRED Data Science/DC_Education.csv")


Merged_Data3 <- VA_Homes %>%
  inner_join(VA_Education, by = "DATE") %>%
  inner_join(DC_Homes, by = "DATE") %>%
  inner_join(DC_Education, by = "DATE")


Merged_Data3 <- Merged_Data3 %>% rename (VA_Home = VAHOWN, DC_Home = DCHOWN, VA_Educate = GCT1502VA, DC_Educate = GCT1502DC)


Raw_Variables3 <- Merged_Data3 %>%
  select(VA_Home, DC_Home, VA_Educate, DC_Educate)



Variables3 <- Raw_Variables3 %>%
  mutate(
    VA_Home = as.numeric(VA_Home),
    DC_Home = as.numeric(DC_Home),
    VA_Educate = as.numeric(VA_Educate),
    DC_Educate = as.numeric(DC_Educate)
  )


Correlation_Matrix3 <- cor(Variables3)
print(Correlation_Matrix3)


